<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Hypomnemata</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
  <style>
    :root {
      --bg:#f9f8f5;
      --card:#3a3a3a;
      --text:#000000;
      --border:#2b3242;
      --footer-bg:#3a3a3a;
      --footer-text:#f9f8f5;
      --highlight:#d4a44b;
    }
    html, body {
      height:100%;
      margin:0;
      background:var(--bg);
      color:var(--text);
      font:14px/1.5 "Inter",system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
      overflow:hidden;
    }
    .wrap {
      height:100vh;
      width:100%;
      display:flex;
      flex-direction:column;
    }
    header {
      flex:0 0 auto;
      padding:10px 16px 12px;
      background:var(--card);
      display:flex;
      flex-direction:column;
      gap:6px;
      border-bottom:1px solid var(--border);
      z-index:10;
      color:#fff;
    }
    .header-top {
      display:flex;
      align-items:center;
      justify-content:space-between;
      width:100%;
    }
    header h1 {
      font-size:16px;
      margin:0;
      color:white;
      font-weight:600;
    }
    .header-bottom {
      display:flex;
      flex-wrap:wrap;
      justify-content:space-between;
      align-items:flex-start;
      width:100%;
      gap:12px;
    }
    .hypo-desc {
      color:#fff;
      font-size:14px;
      font-weight:400;
      line-height:1.4;
      max-width:960px;
      opacity:.9;
      margin-top:4px;
      flex:1 1 60%;
      min-width:240px;
    }
    .legend-block {
      display:flex;
      flex-direction:column;
      align-items:flex-end;
      color:white;
      flex:0 0 auto;
      min-width:max-content;
    }
    .legend {
      display:flex;
      flex-wrap:wrap;
      row-gap:6px;
      column-gap:10px;
      align-items:center;
      color:white;
      font-size:16px;
      font-weight:500;
    }
    .dot {
      width:10px;
      height:10px;
      border-radius:50%;
      display:inline-block;
    }
    .author-icon,.philosophy-icon,.practice-icon {
      width:12px;
      height:12px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      border-radius:50%;
      font-size:12px;
      line-height:1;
      background:transparent;
      border:none;
      color:#000;
    }
    .philosophy-icon {color:#b4c8a8;}
    .practice-icon {color:#e8c670;}
    .physics-toggle {
      display:flex;
      align-items:center;
      gap:8px;
      font-size:14px;
      line-height:1.2;
      font-weight:500;
      color:#fff;
      margin-top:4px;
      justify-content:flex-end;
      width:100%;
    }
    .switch {
      position:relative;
      display:inline-block;
      width:34px;
      height:18px;
      flex-shrink:0;
    }
    .switch input {opacity:0;width:0;height:0;}
    .slider {
      position:absolute;
      cursor:pointer;
      top:0;left:0;right:0;bottom:0;
      background-color:#555;
      border-radius:10px;
      transition:.2s;
      border:1px solid #222;
    }
    .slider:before {
      position:absolute;
      content:"";
      height:12px;
      width:12px;
      left:3px;
      top:2px;
      background-color:#fff;
      border-radius:50%;
      transition:.2s;
      box-shadow:0 1px 2px rgba(0,0,0,.6);
    }
    input:checked + .slider {background-color:var(--highlight);border-color:#3a3a3a;}
    input:checked + .slider:before {transform:translateX(16px);}
    #viz {flex:1;min-height:0;position:relative;background:transparent;z-index:0;overflow:hidden;}
    #details {
      flex:0 0 auto;
      background:var(--footer-bg);
      color:var(--footer-text);
      border-top:1px solid #4a4a4a;
      box-shadow:0 -4px 12px rgba(0,0,0,.25);
      padding:20px 0 24px;
      font-size:16px;
      line-height:1.5;
    }
    .details-inner {max-width:960px;margin:0 auto;width:100%;padding:0 24px;min-height:140px;}
    #details h2 {margin:0 0 6px;font-size:16px;font-weight:600;color:var(--footer-text);line-height:1.3;}
    #details .meta {font-size:12px;font-weight:500;color:#ccc;margin-bottom:6px;text-transform:capitalize;line-height:1.2;}
    #details .desc {font-size:13px;color:var(--footer-text);white-space:pre-wrap;line-height:1.5;}
  </style>
  <script src="https://unpkg.com/vis-network@9.1.6/dist/vis-network.min.js"></script>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="header-top">
        <h1>Hypomnemata</h1>
      </div>
      <div class="header-bottom">
        <div class="hypo-desc">
          Hypomnemata (Greek: ὑπομνήματα) were personal notebooks or written records used in antiquity as aids to memory, reflection, and ethical self-formation. They were not merely diaries but spiritual exercises — tools for shaping one’s moral and philosophical life through the active recollection and application of knowledge.
        </div>
        <div class="legend-block">
          <div class="legend">
            <span class="philosophy-icon"><i class="fa-solid fa-brain"></i></span><small>Philosophy</small>
            <span class="dot" style="background:#e8b7b7"></span><small>Dogma</small>
            <span class="practice-icon"><i class="fa-solid fa-sync-alt"></i></span><small>Practice</small>
            <span class="author-icon"><i class="fa-solid fa-user"></i></span><small>Author</small>
          </div>
          <div class="physics-toggle"><span>Dynamic graph</span>
            <label class="switch"><input type="checkbox" id="physicsToggle" checked /><span class="slider"></span></label>
          </div>
        </div>
      </div>
    </header>
    <div id="viz"></div>
    <section id="details">
      <div class="details-inner">
        <h2 id="details-title">Select a node</h2>
        <div class="meta" id="details-type">—</div>
        <div class="desc" id="details-desc">Click any node in the graph to see its description here.</div>
      </div>
    </section>
  </div>
  <script>
  (function(){
    var endpoint="/api/graph";
    var container=document.getElementById("viz");
    var title=document.getElementById("details-title"),type=document.getElementById("details-type"),desc=document.getElementById("details-desc");
    var toggle=document.getElementById("physicsToggle");
    var colors={PHILOSOPHY:"#b4c8a8",DOGMA:"#e8b7b7",CONCEPT:"#b8cde2",PRACTICE:"#f3d9a4",RELATION:"#d5c7b3"};
    function id(o){return(o&&(o.id||o.identity||o.elementId||(o.properties&&o.properties.id)))||null;}
    function label(o){if(o&&o.properties){if(o.properties.title)return o.properties.title;if(o.properties.name)return o.properties.name;}return(o.labels&&o.labels[0])||"Node";}
    function descf(o){var p=o.properties||{};return p.description&&p.description.trim()?p.description:"No description available.";}
    function typ(o){return(o.labels&&o.labels[0]?o.labels[0].toLowerCase():"node");}
    function author(t){return t&&t.toUpperCase()==="AUTHOR";}
    function phil(t){return t&&t.toUpperCase()==="PHILOSOPHY";}
    function build(n){
  var p=(n.labels&&n.labels[0])||"Node",
      b={id:id(n),label:label(n),group:p,_desc:descf(n),_type:typ(n)};

  if(author(p)){
    b.shape="icon";
    b.icon={face:"FontAwesome",code:"\uf007",size:30,color:"#000"};
  } else if(phil(p)){
    b.shape="icon";
    b.icon={face:"FontAwesome",code:"\uf5dc",size:35,color:colors[p]||"#b4c8a8"};
  } else if(p && p.toUpperCase()==="PRACTICE"){
    b.shape="icon";
    b.icon={face:"FontAwesome",code:"\uf2f1",size:35,color:"#e8c670"};
  } else {
    b.color={background:colors[p]||"#d5c7b3",border:"#333",
      highlight:{background:"#d4a44b",border:"#3a3a3a"},
      hover:{background:"#d4a44b",border:"#3a3a3a"}};
  }
  return b;
}
    fetch(endpoint+"?limit=1000").then(r=>r.json()).then(d=>{
      var rows=(d&&d.data&&d.data.values)||[],nmap=new Map(),emap=new Map(),rawN=[],rawE=[];
      rows.forEach(r=>{if(r[0])rawN.push(r[0]);if(r[2])rawN.push(r[2]);if(r[1])rawE.push(r[1]);});
      rawN.forEach(n=>{var i=id(n);if(i&&!nmap.has(i))nmap.set(i,build(n));});
      rawE.forEach(e=>{var i=id(e),f=e.startNodeElementId||e.start||e.from,t=e.endNodeElementId||e.end||e.to;
        if(i&&f&&t&&!emap.has(i)){var lab=e.type?"<i>"+e.type.replace(/_/g," ").toLowerCase().replace(/^\w/,c=>c.toUpperCase())+"</i>":"";
          emap.set(i,{id:i,from:f,to:t,label:lab,arrows:"to",length:260,color:{color:"#d5c7b3",highlight:"#d4a44b",hover:"#d4a44b"}});}});
      var nodes=new vis.DataSet([...nmap.values()]),edges=new vis.DataSet([...emap.values()]);
      var net=new vis.Network(container,{nodes:nodes,edges:edges},{
        nodes:{shape:"dot",size:23,borderWidth:2,font:{color:"#000",size:16,face:"Inter, system-ui"}},
        edges:{width:1.5,color:{color:"#d5c7b3",highlight:"#d4a44b",hover:"#d4a44b"},smooth:false,font:{multi:"html",face:"Inter",color:"#000"}},
        interaction:{hover:true,tooltipDelay:150},
        physics:{enabled:true,solver:"forceAtlas2Based",forceAtlas2Based:{gravitationalConstant:-20,centralGravity:0.002,springLength:260,springConstant:0.03,avoidOverlap:1},stabilization:{iterations:400}}});
      net.on("click",p=>{if(p.nodes.length>0){var n=nodes.get(p.nodes[0]);title.textContent=n.label;type.textContent=n._type;desc.textContent=n._desc;}});
      toggle.addEventListener("change",()=>{net.setOptions({physics:{enabled:toggle.checked}});});
    });
  })();
  </script>
</body>
</html>